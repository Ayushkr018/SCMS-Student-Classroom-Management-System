<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Session - SCMS Teacher</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* Light Mode Colors */
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1a202c;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --border-color: #e2e8f0;
            --border-light: #f1f5f9;
            --shadow-light: rgba(0,0,0,0.08);
            --shadow-medium: rgba(0,0,0,0.1);
            --shadow-heavy: rgba(0,0,0,0.25);
            --accent-green: #10b981;
            --accent-green-dark: #059669;
            --accent-green-light: #34d399;
            --accent-blue: #2563eb;
            --accent-blue-dark: #1d4ed8;
            --accent-yellow: #f59e0b;
            --accent-red: #ef4444;
        }

        [data-theme="dark"] {
            /* Dark Mode Colors */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #334155;
            --border-light: #475569;
            --shadow-light: rgba(0,0,0,0.3);
            --shadow-medium: rgba(0,0,0,0.4);
            --shadow-heavy: rgba(0,0,0,0.6);
            --accent-green: #34d399;
            --accent-green-dark: #10b981;
            --accent-green-light: #6ee7b7;
            --accent-blue: #3b82f6;
            --accent-blue-dark: #2563eb;
            --accent-yellow: #fbbf24;
            --accent-red: #f87171;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Allow text selection only for inputs */
        input, textarea, [contenteditable="true"] {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-secondary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-primary);
            box-shadow: 2px 0 20px var(--shadow-light);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 30px 25px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .sidebar-header h2 {
            font-size: 1.8em;
            color: var(--accent-green);
            margin-bottom: 5px;
        }

        .sidebar-header p {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent-green), var(--accent-green-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .user-dept {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* Theme Toggle in Sidebar */
        .theme-toggle-sidebar {
            margin: 20px 25px;
            padding: 12px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle-sidebar:hover {
            border-color: var(--accent-green);
            background: var(--bg-tertiary);
        }

        .theme-toggle-icon {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .theme-switch {
            width: 45px;
            height: 24px;
            background: var(--border-color);
            border-radius: 12px;
            position: relative;
            transition: all 0.3s ease;
        }

        .theme-switch.active {
            background: var(--accent-green);
        }

        .theme-switch-handle {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .theme-switch.active .theme-switch-handle {
            transform: translateX(21px);
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .sidebar-nav ul {
            list-style: none;
        }

        .sidebar-nav li {
            margin-bottom: 4px;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 25px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 0 25px 25px 0;
            margin-right: 15px;
        }

        .sidebar-nav li.active a,
        .sidebar-nav a:hover {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-green-dark));
            color: white;
            transform: translateX(5px);
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
            transition: all 0.3s ease;
        }

        .mobile-header {
            display: none;
            background: var(--bg-primary);
            padding: 15px 20px;
            box-shadow: 0 2px 10px var(--shadow-light);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1100;
        }

        .mobile-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mobile-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-green);
        }

        .mobile-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mobile-menu-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .mobile-menu-btn:hover {
            background: var(--bg-secondary);
            color: var(--accent-green);
        }

        .mobile-theme-toggle {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .mobile-theme-toggle:hover {
            background: var(--accent-green);
            color: white;
            border-color: var(--accent-green);
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .session-header {
            background: var(--bg-primary);
            padding: 25px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px var(--shadow-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .session-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-green), var(--accent-red));
            animation: liveIndicator 3s linear infinite;
        }

        @keyframes liveIndicator {
            0% { background-position: -100% 0; }
            100% { background-position: 100% 0; }
        }

        .session-info h1 {
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .session-details {
            display: flex;
            gap: 25px;
            color: var(--text-secondary);
            font-size: 0.95em;
            flex-wrap: wrap;
        }

        .live-badge {
            background: var(--accent-red);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            text-transform: uppercase;
            animation: livePulse 2s infinite;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @keyframes livePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .session-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--accent-red), #dc2626);
            color: white;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-green-dark));
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--accent-yellow), #d97706);
            color: var(--text-primary);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-blue-dark));
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .session-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
        }

        .main-session {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .session-card {
            background: var(--bg-primary);
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow-light);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .session-card:hover {
            box-shadow: 0 8px 30px var(--shadow-medium);
        }

        .card-header {
            padding: 20px 25px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-secondary);
        }

        .card-header h3 {
            font-size: 1.2em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .whiteboard-area {
            height: 400px;
            background: var(--bg-primary);
            position: relative;
            border: 2px dashed var(--border-color);
            overflow: hidden;
        }

        .whiteboard-tools {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            background: var(--bg-tertiary);
        }

        .tool-btn {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            color: var(--text-primary);
        }

        .tool-btn.active,
        .tool-btn:hover {
            border-color: var(--accent-green);
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent-green);
        }

        .color-picker {
            width: 30px;
            height: 30px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s ease;
        }

        .color-picker:hover {
            transform: scale(1.1);
        }

        .canvas-container {
            position: relative;
            width: 100%;
            height: 100%;
        }

        #drawingCanvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: crosshair;
            background: var(--bg-primary);
        }

        #textInput {
            position: absolute;
            border: 2px solid var(--accent-green);
            background: var(--bg-primary);
            padding: 8px 12px;
            font-size: 16px;
            font-family: Arial, sans-serif;
            outline: none;
            z-index: 1000;
            display: none;
            min-width: 150px;
            border-radius: 4px;
            box-shadow: 0 2px 10px var(--shadow-light);
            color: var(--text-primary);
        }

        #textInput:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }

        .screen-share {
            height: 300px;
            background: #000;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2em;
            position: relative;
            overflow: hidden;
        }

        .screen-share::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: screenScan 3s linear infinite;
        }

        @keyframes screenScan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .screen-controls {
            padding: 15px 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .student-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
        }

        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .student-item:hover {
            background: var(--bg-secondary);
        }

        .student-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .student-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-blue-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8em;
            font-weight: 600;
        }

        .student-name {
            font-weight: 600;
            font-size: 0.9em;
            color: var(--text-primary);
        }

        .student-status-text {
            font-size: 0.8em;
            color: var(--text-secondary);
            text-transform: capitalize;
        }

        .student-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent-green);
            position: relative;
        }

        .student-status.offline {
            background: var(--accent-red);
        }

        .student-status.away {
            background: var(--accent-yellow);
        }

        .student-status::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            animation: statusPulse 2s infinite;
        }

        @keyframes statusPulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        .chat-area {
            height: 300px;
            overflow-y: auto;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .chat-message {
            margin-bottom: 15px;
            animation: messageSlideIn 0.3s ease;
        }

        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .message-avatar {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7em;
            font-weight: 600;
        }

        .message-name {
            font-weight: 600;
            font-size: 0.85em;
            color: var(--text-primary);
        }

        .message-time {
            font-size: 0.75em;
            color: var(--text-secondary);
            margin-left: auto;
        }

        .message-text {
            background: var(--bg-primary);
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 0.9em;
            color: var(--text-primary);
            margin-left: 33px;
            border: 1px solid var(--border-color);
        }

        .chat-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            font-size: 0.9em;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        .chat-input button {
            padding: 10px 15px;
            background: var(--accent-green);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            background: var(--accent-green-dark);
        }

        .poll-creator {
            padding: 20px;
        }

        .poll-input {
            margin-bottom: 15px;
        }

        .poll-input input,
        .poll-input textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9em;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .poll-input input:focus,
        .poll-input textarea:focus {
            outline: none;
            border-color: var(--accent-green);
        }

        .poll-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }

        .poll-option {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .poll-option input {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 0.85em;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .active-poll {
            padding: 20px;
            border: 2px solid var(--accent-green);
            border-radius: 10px;
            background: rgba(16, 185, 129, 0.05);
        }

        .poll-question {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-primary);
        }

        .poll-responses {
            margin-top: 15px;
        }

        .response-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .response-option {
            min-width: 60px;
            font-size: 0.9em;
            font-weight: 500;
            color: var(--text-primary);
        }

        .response-progress {
            flex: 1;
            height: 20px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .response-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-green-dark));
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .response-count {
            font-weight: 600;
            color: var(--accent-green);
            min-width: 30px;
            text-align: right;
        }

        .session-timer {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px var(--shadow-medium);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            border: 2px solid var(--accent-green);
            background: var(--bg-primary);
        }

        .timer-display {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--accent-green);
            font-family: 'Courier New', monospace;
        }

        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px var(--shadow-medium);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--accent-green), var(--accent-green-dark));
        }

        .notification.error {
            background: linear-gradient(135deg, var(--accent-red), #dc2626);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-blue-dark));
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--accent-yellow), #d97706);
            color: var(--text-primary);
        }

        .floating-tools {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3em;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .fab.record {
            background: linear-gradient(135deg, var(--accent-red), #dc2626);
            animation: recordPulse 2s infinite;
        }

        .fab.mute {
            background: linear-gradient(135deg, var(--accent-yellow), #d97706);
        }

        .fab.screen {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-blue-dark));
        }

        @keyframes recordPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Mobile Responsive Design */
        @media (max-width: 1200px) {
            .session-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .side-panel {
                order: 2;
            }
            
            .main-session {
                order: 1;
            }
        }

        @media (max-width: 1024px) {
            .whiteboard-tools {
                flex-wrap: wrap;
                gap: 8px;
                padding: 15px;
            }
            
            .session-timer {
                position: static;
                margin-bottom: 20px;
                align-self: flex-start;
            }
            
            .session-details {
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .sidebar-overlay.active {
                display: block;
            }
            
            .main-content {
                margin-left: 0;
                padding: 15px;
                padding-top: 80px;
            }
            
            .mobile-header {
                display: block;
            }
            
            .session-header {
                padding: 20px;
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .session-controls {
                width: 100%;
                justify-content: center;
            }
            
            .session-details {
                flex-direction: column;
                gap: 10px;
            }
            
            .whiteboard-area {
                height: 300px;
            }
            
            .screen-share {
                height: 250px;
            }
            
            .floating-tools {
                flex-direction: row;
                bottom: 20px;
                right: 20px;
                gap: 10px;
            }
            
            .fab {
                width: 50px;
                height: 50px;
                font-size: 1.1em;
            }
            
            .student-list {
                max-height: 250px;
            }
            
            .chat-area {
                height: 250px;
            }
            
            .card-header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .notification {
                top: 15px;
                right: 15px;
                left: 15px;
                transform: translateY(-100px);
            }
            
            .notification.show {
                transform: translateY(0);
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
                padding-top: 75px;
            }
            
            .session-header {
                padding: 15px;
            }
            
            .session-header h1 {
                font-size: 1.3rem;
            }
            
            .whiteboard-tools {
                padding: 12px;
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .tool-btn {
                padding: 10px;
                text-align: center;
                justify-content: center;
            }
            
            .whiteboard-area {
                height: 250px;
            }
            
            .screen-share {
                height: 200px;
            }
            
            .card-header {
                padding: 12px 15px;
            }
            
            .poll-creator {
                padding: 15px;
            }
            
            .student-list {
                padding: 12px;
                max-height: 200px;
            }
            
            .chat-area {
                height: 200px;
                padding: 12px;
            }
            
            .fab {
                width: 45px;
                height: 45px;
                font-size: 1rem;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 0.85rem;
            }
            
            .session-timer {
                padding: 12px 15px;
                font-size: 0.9rem;
            }
            
            .timer-display {
                font-size: 1rem;
            }
        }

        @media (max-width: 360px) {
            .main-content {
                padding: 8px;
                padding-top: 70px;
            }
            
            .session-header {
                padding: 12px;
            }
            
            .mobile-header {
                padding: 12px 15px;
            }
            
            .mobile-logo {
                font-size: 1rem;
            }
            
            .whiteboard-area {
                height: 200px;
            }
            
            .screen-share {
                height: 180px;
            }
            
            .card-header {
                padding: 10px 12px;
            }
            
            .student-item {
                padding: 8px;
                flex-direction: column;
                text-align: center;
                gap: 5px;
            }
            
            .poll-creator {
                padding: 12px;
            }
            
            .fab {
                width: 40px;
                height: 40px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <div class="mobile-logo">
                🎓 <span>SCMS Live</span>
            </div>
            <div class="mobile-controls">
                <button class="mobile-theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
                    <i class="fas fa-moon" id="mobileThemeIcon"></i>
                </button>
                <button class="mobile-menu-btn" onclick="toggleMobileSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>

    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>🎓 SCMS</h2>
                <p>Teacher Portal</p>
            </div>
            
            <div class="user-info" id="userInfo">
                <div class="user-avatar">
                    <i class="fas fa-chalkboard-teacher"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">Loading...</div>
                    <div class="user-dept" id="userDept">Computer Science</div>
                </div>
            </div>
            
            <!-- Theme Toggle in Sidebar -->
            <div class="theme-toggle-sidebar" onclick="toggleTheme()">
                <div class="theme-toggle-icon">
                    <i class="fas fa-moon" id="themeIcon"></i>
                    <span id="themeLabel">Dark Mode</span>
                </div>
                <div class="theme-switch" id="themeSwitch">
                    <div class="theme-switch-handle"></div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="dashboard.html">
                            <i class="fas fa-tachometer-alt"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="active">
                        <a href="session.html">
                            <i class="fas fa-chalkboard"></i>
                            Live Session
                        </a>
                    </li>
                    <li>
                        <a href="attendance.html">
                            <i class="fas fa-user-check"></i>
                            Attendance
                        </a>
                    </li>
                    <li>
                        <a href="resources.html">
                            <i class="fas fa-tools"></i>
                            Resources
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            Logout
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Session Header -->
            <div class="session-header">
                <div class="session-info">
                    <h1>CS101 - Data Structures</h1>
                    <div class="session-details">
                        <span><i class="fas fa-clock"></i> Started: 10:05 AM</span>
                        <span><i class="fas fa-users"></i> 35/45 Students</span>
                        <span><i class="fas fa-map-marker-alt"></i> Room 201</span>
                        <span><i class="fas fa-calendar"></i> January 15, 2024</span>
                    </div>
                </div>
                <div class="session-controls">
                    <div class="live-badge">
                        <i class="fas fa-circle"></i>
                        LIVE
                    </div>
                    <button class="btn btn-warning" onclick="pauseSession()">
                        <i class="fas fa-pause"></i>
                        Pause
                    </button>
                    <button class="btn btn-danger" onclick="endSession()">
                        <i class="fas fa-stop"></i>
                        End Session
                    </button>
                </div>
            </div>

            <!-- Session Timer -->
            <div class="session-timer">
                <i class="fas fa-stopwatch"></i>
                <div class="timer-display" id="sessionTimer">00:25:43</div>
            </div>

            <!-- Main Session Grid -->
            <div class="session-grid">
                <!-- Main Session Area -->
                <div class="main-session">
                    <!-- Digital Whiteboard -->
                    <div class="session-card">
                        <div class="card-header">
                            <h3><i class="fas fa-marker"></i> Digital Whiteboard</h3>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-info" onclick="saveWhiteboard()">
                                    <i class="fas fa-save"></i>
                                    Save
                                </button>
                                <button class="btn btn-warning" onclick="clearWhiteboard()">
                                    <i class="fas fa-eraser"></i>
                                    Clear
                                </button>
                                <button class="btn btn-danger" onclick="undoLastAction()">
                                    <i class="fas fa-undo"></i>
                                    Undo
                                </button>
                            </div>
                        </div>
                        <div class="whiteboard-tools">
                            <div class="tool-btn active" onclick="selectTool('pen')" id="penTool">
                                <i class="fas fa-pen"></i> Pen
                            </div>
                            <div class="tool-btn" onclick="selectTool('eraser')" id="eraserTool">
                                <i class="fas fa-eraser"></i> Eraser
                            </div>
                            <div class="tool-btn" onclick="selectTool('text')" id="textTool">
                                <i class="fas fa-font"></i> Text
                            </div>
                            <div class="tool-btn" onclick="selectTool('rectangle')" id="rectangleTool">
                                <i class="fas fa-square"></i> Rectangle
                            </div>
                            <div class="tool-btn" onclick="selectTool('circle')" id="circleTool">
                                <i class="fas fa-circle"></i> Circle
                            </div>
                            <div class="tool-btn" onclick="selectTool('line')" id="lineTool">
                                <i class="fas fa-minus"></i> Line
                            </div>
                            
                            <div style="margin-left: 20px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                                <span style="color: var(--text-primary);">Color:</span>
                                <div class="color-picker" style="background: #000; border: 3px solid var(--accent-green);" onclick="selectColor('#000')" data-color="#000"></div>
                                <div class="color-picker" style="background: #dc3545;" onclick="selectColor('#dc3545')" data-color="#dc3545"></div>
                                <div class="color-picker" style="background: #28a745;" onclick="selectColor('#28a745')" data-color="#28a745"></div>
                                <div class="color-picker" style="background: #007bff;" onclick="selectColor('#007bff')" data-color="#007bff"></div>
                                <div class="color-picker" style="background: #ffc107;" onclick="selectColor('#ffc107')" data-color="#ffc107"></div>
                                <div class="color-picker" style="background: #6f42c1;" onclick="selectColor('#6f42c1')" data-color="#6f42c1"></div>
                            </div>
                            
                            <div style="margin-left: 20px; display: flex; align-items: center; gap: 8px;">
                                <label style="color: var(--text-primary);">Size: </label>
                                <input type="range" id="brushSize" min="1" max="20" value="3" style="width: 80px;">
                                <span id="sizeValue" style="color: var(--text-primary);">3px</span>
                            </div>
                        </div>
                        <div class="whiteboard-area">
                            <div class="canvas-container">
                                <canvas id="drawingCanvas" width="800" height="400"></canvas>
                                <input type="text" id="textInput" placeholder="Type your text here...">
                            </div>
                        </div>
                    </div>

                    <!-- Screen Share -->
                    <div class="session-card">
                        <div class="card-header">
                            <h3><i class="fas fa-desktop"></i> Screen Sharing</h3>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="startScreenShare()" id="shareBtn">
                                    <i class="fas fa-share-square"></i>
                                    Start Sharing
                                </button>
                                <button class="btn btn-info" onclick="shareApplication()">
                                    <i class="fas fa-window-maximize"></i>
                                    Share App
                                </button>
                            </div>
                        </div>
                        <div class="screen-share" id="screenShareArea">
                            <div style="text-align: center;">
                                <i class="fas fa-desktop" style="font-size: 4em; margin-bottom: 20px; opacity: 0.5;"></i>
                                <p>Screen sharing inactive</p>
                                <small>Click "Start Sharing" to share your screen with students</small>
                            </div>
                        </div>
                        <div class="screen-controls" id="screenControls" style="display: none;">
                            <button class="btn btn-warning" onclick="pauseScreenShare()">
                                <i class="fas fa-pause"></i>
                                Pause
                            </button>
                            <button class="btn btn-danger" onclick="stopScreenShare()">
                                <i class="fas fa-stop"></i>
                                Stop
                            </button>
                            <button class="btn btn-info" onclick="togglePointer()">
                                <i class="fas fa-mouse-pointer"></i>
                                Pointer
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Side Panel -->
                <div class="side-panel">
                    <!-- Live Students -->
                    <div class="session-card">
                        <div class="card-header">
                            <h3><i class="fas fa-users"></i> Live Students (35)</h3>
                            <button class="btn btn-primary" onclick="refreshStudents()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="student-list" id="studentList">
                            <!-- Students will be loaded here -->
                        </div>
                    </div>

                    <!-- Live Chat -->
                    <div class="session-card">
                        <div class="card-header">
                            <h3><i class="fas fa-comments"></i> Live Chat</h3>
                            <button class="btn btn-warning" onclick="toggleChat()" id="chatToggle">
                                <i class="fas fa-eye"></i>
                                Hide
                            </button>
                        </div>
                        <div class="chat-area" id="chatArea">
                            <!-- Chat messages will appear here -->
                        </div>
                        <div class="chat-input">
                            <input type="text" id="chatInput" placeholder="Type a message to students..." 
                                   onkeypress="handleChatEnter(event)">
                            <button onclick="sendMessage()">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Interactive Poll -->
                    <div class="session-card">
                        <div class="card-header">
                            <h3><i class="fas fa-poll"></i> Interactive Poll</h3>
                            <button class="btn btn-primary" onclick="togglePollCreator()" id="pollToggle">
                                <i class="fas fa-plus"></i>
                                Create
                            </button>
                        </div>
                        
                        <div class="poll-creator" id="pollCreator" style="display: none;">
                            <div class="poll-input">
                                <textarea id="pollQuestion" placeholder="Enter your question..." rows="2"></textarea>
                            </div>
                            <div class="poll-options">
                                <div class="poll-option">
                                    <input type="text" placeholder="Option A" id="option1">
                                    <i class="fas fa-times" onclick="removeOption(this)" style="cursor: pointer; color: var(--accent-red);"></i>
                                </div>
                                <div class="poll-option">
                                    <input type="text" placeholder="Option B" id="option2">
                                    <i class="fas fa-times" onclick="removeOption(this)" style="cursor: pointer; color: var(--accent-red);"></i>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="launchPoll()">
                                    <i class="fas fa-rocket"></i>
                                    Launch Poll
                                </button>
                                <button class="btn" onclick="addPollOption()" 
                                        style="background: var(--text-secondary); color: white;">
                                    <i class="fas fa-plus"></i>
                                    Add Option
                                </button>
                            </div>
                        </div>
                        
                        <div id="activePollArea">
                            <div style="padding: 30px; text-align: center; color: var(--text-secondary);">
                                <i class="fas fa-poll" style="font-size: 2.5em; margin-bottom: 15px; opacity: 0.5;"></i>
                                <p>No active poll</p>
                                <small>Create a poll to engage with your students</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Tools -->
    <div class="floating-tools">
        <div class="fab record" onclick="toggleRecording()" title="Record Session">
            <i class="fas fa-video" id="recordIcon"></i>
        </div>
        <div class="fab mute" onclick="toggleMute()" title="Mute Audio">
            <i class="fas fa-microphone" id="muteIcon"></i>
        </div>
        <div class="fab screen" onclick="toggleFullscreen()" title="Fullscreen">
            <i class="fas fa-expand" id="fullscreenIcon"></i>
        </div>
    </div>

    <script>
        // Theme Management - Consistent with Landing Page
        function initializeTheme() {
            const savedTheme = localStorage.getItem('scms-theme') || 'light';
            const themeIcon = document.getElementById('themeIcon');
            const mobileThemeIcon = document.getElementById('mobileThemeIcon');
            const themeLabel = document.getElementById('themeLabel');
            const themeSwitch = document.getElementById('themeSwitch');
            
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                mobileThemeIcon.className = 'fas fa-sun';
                themeLabel.textContent = 'Light Mode';
                themeSwitch.classList.add('active');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                themeIcon.className = 'fas fa-moon';
                mobileThemeIcon.className = 'fas fa-moon';
                themeLabel.textContent = 'Dark Mode';
                themeSwitch.classList.remove('active');
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const themeIcon = document.getElementById('themeIcon');
            const mobileThemeIcon = document.getElementById('mobileThemeIcon');
            const themeLabel = document.getElementById('themeLabel');
            const themeSwitch = document.getElementById('themeSwitch');
            
            if (currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('scms-theme', 'light');
                themeIcon.className = 'fas fa-moon';
                mobileThemeIcon.className = 'fas fa-moon';
                themeLabel.textContent = 'Dark Mode';
                themeSwitch.classList.remove('active');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('scms-theme', 'dark');
                themeIcon.className = 'fas fa-sun';
                mobileThemeIcon.className = 'fas fa-sun';
                themeLabel.textContent = 'Light Mode';
                themeSwitch.classList.add('active');
            }
        }

        // Mobile Sidebar Management
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Mock student data
        const STUDENTS_DATA = [
            { id: 'st001', name: 'Raj Kumar', avatar: 'RK', status: 'online' },
            { id: 'st002', name: 'Priya Sharma', avatar: 'PS', status: 'online' },
            { id: 'st003', name: 'Arjun Patel', avatar: 'AP', status: 'away' },
            { id: 'st004', name: 'Sneha Gupta', avatar: 'SG', status: 'online' },
            { id: 'st005', name: 'Vikram Singh', avatar: 'VS', status: 'offline' },
            { id: 'st006', name: 'Anita Rao', avatar: 'AR', status: 'online' },
            { id: 'st007', name: 'Rohit Mehta', avatar: 'RM', status: 'online' },
            { id: 'st008', name: 'Kavya Nair', avatar: 'KN', status: 'away' }
        ];

        // Session state
        let sessionStartTime = new Date();
        let isRecording = false;
        let isMuted = false;
        let isScreenSharing = false;
        let activePoll = null;
        let currentTool = 'pen';
        let currentColor = '#000';
        let currentSize = 3;
        let isDrawing = false;
        let chatMessages = [];

        // Canvas setup
        let canvas, ctx;
        let canvasHistory = [];
        let historyStep = -1;

        // Shape drawing variables
        let startX, startY;
        let isDrawingShape = false;

        // Text tool variables
        let textInput;
        let isAddingText = false;

        // Initialize session
        document.addEventListener('DOMContentLoaded', function() {
            initializeTheme();
            loadCurrentUser();
            initializeWhiteboard();
            loadStudents();
            startSessionTimer();
            initializeChat();
            startLiveUpdates();
            
            // Close mobile sidebar when resizing to desktop
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    closeMobileSidebar();
                }
            });
        });

        function loadCurrentUser() {
            const currentUser = localStorage.getItem('scms_current_user');
            if (!currentUser) {
                const defaultUser = {
                    name: 'Prof. John Smith',
                    role: 'teacher',
                    department: 'computer_science'
                };
                localStorage.setItem('scms_current_user', JSON.stringify(defaultUser));
            }

            const user = JSON.parse(localStorage.getItem('scms_current_user'));
            if (user.role !== 'teacher') {
                alert('Access denied. Teacher privileges required.');
                window.location.href = '../index.html';
                return;
            }

            document.getElementById('userName').textContent = user.name || 'Teacher';
            
            if (user.department) {
                document.getElementById('userDept').textContent = 
                    user.department.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
            }
        }

        function logout() {
            if (confirm('End session and logout?')) {
                localStorage.removeItem('scms_current_user');
                showNotification('Session ended. Logging out...', 'info');
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 2000);
            }
        }

        function initializeWhiteboard() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            textInput = document.getElementById('textInput');
            
            // Set canvas size to fill container
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            // Set drawing properties
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentSize;
            
            // Save initial state
            saveCanvasState();
            
            // Mouse events for drawing
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('mouseout', handleMouseUp);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', handleTouchEnd);
            
            // Text input events
            textInput.addEventListener('keydown', handleTextInput);
            textInput.addEventListener('blur', finishTextInput);
            textInput.addEventListener('input', updateTextInputSize);
            
            // Brush size slider
            document.getElementById('brushSize').addEventListener('input', function(e) {
                currentSize = e.target.value;
                document.getElementById('sizeValue').textContent = e.target.value + 'px';
                ctx.lineWidth = currentSize;
            });
        }

        function handleMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (currentTool === 'pen') {
                isDrawing = true;
                ctx.beginPath();
                ctx.moveTo(x, y);
            } else if (currentTool === 'eraser') {
                isDrawing = true;
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath();
                ctx.arc(x, y, currentSize, 0, 2 * Math.PI);
                ctx.fill();
            } else if (currentTool === 'text') {
                startTextInput(x, y);
            } else if (['rectangle', 'circle', 'line'].includes(currentTool)) {
                isDrawingShape = true;
                startX = x;
                startY = y;
            }
        }

        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            if (currentTool === 'pen' && isDrawing) {
                ctx.lineTo(x, y);
                ctx.stroke();
            } else if (currentTool === 'eraser' && isDrawing) {
                ctx.beginPath();
                ctx.arc(x, y, currentSize, 0, 2 * Math.PI);
                ctx.fill();
            }
        }

        function handleMouseUp(e) {
            if (isDrawing) {
                isDrawing = false;
                ctx.globalCompositeOperation = 'source-over';
                ctx.beginPath();
                saveCanvasState();
            } else if (isDrawingShape) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                drawShape(startX, startY, x, y);
                isDrawingShape = false;
                saveCanvasState();
            }
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            const mouseEvent = new MouseEvent('mouseup', {});
            canvas.dispatchEvent(mouseEvent);
        }

        function selectTool(tool) {
            if (isAddingText) {
                finishTextInput();
            }
            
            currentTool = tool;
            
            // Update tool buttons
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tool + 'Tool').classList.add('active');
            
            // Update cursor and settings
            if (tool === 'pen') {
                canvas.style.cursor = 'crosshair';
                ctx.globalCompositeOperation = 'source-over';
            } else if (tool === 'eraser') {
                canvas.style.cursor = 'grab';
            } else if (tool === 'text') {
                canvas.style.cursor = 'text';
                ctx.globalCompositeOperation = 'source-over';
            } else if (['rectangle', 'circle', 'line'].includes(tool)) {
                canvas.style.cursor = 'crosshair';
                ctx.globalCompositeOperation = 'source-over';
            }
            
            showNotification(`${tool.charAt(0).toUpperCase() + tool.slice(1)} tool selected`, 'info');
        }

        function selectColor(color) {
            currentColor = color;
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            
            // Update color picker selection
            document.querySelectorAll('.color-picker').forEach(picker => {
                picker.style.border = picker.dataset.color === color ? 
                    '3px solid var(--accent-green)' : '2px solid var(--border-color)';
            });
            
            // Update text input color
            if (textInput) {
                textInput.style.color = color;
            }
            
            showNotification(`Color changed to ${color}`, 'info');
        }

        // Text input functions
        function startTextInput(x, y) {
            if (isAddingText) {
                finishTextInput();
            }
            
            isAddingText = true;
            
            textInput.style.display = 'block';
            textInput.style.left = Math.max(0, Math.min(x, canvas.width - 150)) + 'px';
            textInput.style.top = Math.max(0, Math.min(y, canvas.height - 40)) + 'px';
            textInput.style.color = currentColor;
            textInput.style.fontSize = Math.max(12, currentSize * 3) + 'px';
            textInput.value = '';
            
            textInput.focus();
            textInput.select();
            
            showNotification('📝 Click anywhere or press Enter to place text', 'info');
        }

        function handleTextInput(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                finishTextInput();
            } else if (e.key === 'Escape') {
                cancelTextInput();
            }
        }

        function updateTextInputSize() {
            const length = textInput.value.length;
            textInput.style.width = Math.max(150, length * 8 + 30) + 'px';
        }

        function finishTextInput() {
            if (!isAddingText || !textInput.value.trim()) {
                cancelTextInput();
                return;
            }
            
            const x = parseInt(textInput.style.left);
            const y = parseInt(textInput.style.top);
            const fontSize = Math.max(12, currentSize * 3);
            
            ctx.font = `${fontSize}px Arial`;
            ctx.fillStyle = currentColor;
            ctx.fillText(textInput.value, x, y + fontSize);
            
            cancelTextInput();
            saveCanvasState();
            showNotification('✅ Text added to whiteboard successfully!', 'success');
        }

        function cancelTextInput() {
            isAddingText = false;
            textInput.style.display = 'none';
            textInput.value = '';
        }

        function drawShape(startX, startY, endX, endY) {
            ctx.strokeStyle = currentColor;
            ctx.lineWidth = currentSize;
            ctx.beginPath();
            
            if (currentTool === 'rectangle') {
                const width = endX - startX;
                const height = endY - startY;
                ctx.rect(startX, startY, width, height);
                ctx.stroke();
            } else if (currentTool === 'circle') {
                const radius = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
                ctx.stroke();
            } else if (currentTool === 'line') {
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.stroke();
            }
        }

        function saveCanvasState() {
            historyStep++;
            if (historyStep < canvasHistory.length) {
                canvasHistory.length = historyStep;
            }
            canvasHistory.push(canvas.toDataURL());
        }

        function undoLastAction() {
            if (historyStep > 0) {
                historyStep--;
                const img = new Image();
                img.onload = function() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                };
                img.src = canvasHistory[historyStep];
                showNotification('↶ Last action undone', 'info');
            } else {
                showNotification('⚠️ Nothing to undo', 'warning');
            }
        }

        function clearWhiteboard() {
            if (confirm('Clear the whiteboard? This action cannot be undone.')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                saveCanvasState();
                showNotification('🗑️ Whiteboard cleared successfully', 'success');
            }
        }

        function saveWhiteboard() {
            const link = document.createElement('a');
            link.download = `whiteboard_${new Date().toISOString().slice(0,19).replace(/:/g, '-')}.png`;
            link.href = canvas.toDataURL();
            link.click();
            
            showNotification('💾 Whiteboard saved successfully', 'success');
        }

        function loadStudents() {
            const studentList = document.getElementById('studentList');
            studentList.innerHTML = '';
            
            STUDENTS_DATA.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.onclick = () => selectStudent(student.id);
                
                studentItem.innerHTML = `
                    <div class="student-profile">
                        <div class="student-avatar">${student.avatar}</div>
                        <div>
                            <div class="student-name">${student.name}</div>
                            <div class="student-status-text">${student.status}</div>
                        </div>
                    </div>
                    <div class="student-status ${student.status}"></div>
                `;
                
                studentList.appendChild(studentItem);
            });
        }

        function selectStudent(studentId) {
            const student = STUDENTS_DATA.find(s => s.id === studentId);
            if (student) {
                showNotification(`Selected ${student.name} - Status: ${student.status}`, 'info');
            }
        }

        function refreshStudents() {
            STUDENTS_DATA.forEach(student => {
                if (Math.random() > 0.8) {
                    const statuses = ['online', 'away', 'offline'];
                    student.status = statuses[Math.floor(Math.random() * statuses.length)];
                }
            });
            
            loadStudents();
            showNotification('🔄 Student status refreshed', 'info');
        }

        function startSessionTimer() {
            setInterval(() => {
                const now = new Date();
                const diff = now - sessionStartTime;
                const hours = Math.floor(diff / 3600000);
                const minutes = Math.floor((diff % 3600000) / 60000);
                const seconds = Math.floor((diff % 60000) / 1000);
                
                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('sessionTimer').textContent = timeString;
            }, 1000);
        }

        function initializeChat() {
            chatMessages = [
                {
                    id: 'msg1',
                    sender: 'Teacher',
                    avatar: 'T',
                    text: 'Welcome to the live session! Feel free to ask questions.',
                    time: new Date(Date.now() - 300000).toLocaleTimeString('en-US', { 
                        hour: 'numeric', 
                        minute: '2-digit',
                        hour12: true 
                    })
                },
                {
                    id: 'msg2',
                    sender: 'Raj Kumar',
                    avatar: 'RK',
                    text: 'Thank you sir! The screen is clear.',
                    time: new Date(Date.now() - 240000).toLocaleTimeString('en-US', { 
                        hour: 'numeric', 
                        minute: '2-digit',
                        hour12: true 
                    })
                }
            ];
            
            displayChatMessages();
        }

        function displayChatMessages() {
            const chatArea = document.getElementById('chatArea');
            chatArea.innerHTML = '';
            
            chatMessages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = 'chat-message';
                
                messageElement.innerHTML = `
                    <div class="message-header">
                        <div class="message-avatar">${message.avatar}</div>
                        <div class="message-name">${message.sender}</div>
                        <div class="message-time">${message.time}</div>
                    </div>
                    <div class="message-text">${message.text}</div>
                `;
                
                chatArea.appendChild(messageElement);
            });
            
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            const newMessage = {
                id: `msg_${Date.now()}`,
                sender: 'Teacher',
                avatar: 'T',
                text: text,
                time: new Date().toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                })
            };
            
            chatMessages.push(newMessage);
            displayChatMessages();
            
            input.value = '';
            showNotification('💬 Message sent to all students', 'success');
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function toggleChat() {
            const chatArea = document.getElementById('chatArea');
            const toggleBtn = document.getElementById('chatToggle');
            
            if (chatArea.style.display === 'none') {
                chatArea.style.display = 'block';
                toggleBtn.innerHTML = '<i class="fas fa-eye"></i> Hide';
            } else {
                chatArea.style.display = 'none';
                toggleBtn.innerHTML = '<i class="fas fa-eye-slash"></i> Show';
            }
        }

        function togglePollCreator() {
            const pollCreator = document.getElementById('pollCreator');
            const toggleBtn = document.getElementById('pollToggle');
            
            if (pollCreator.style.display === 'none') {
                pollCreator.style.display = 'block';
                toggleBtn.innerHTML = '<i class="fas fa-times"></i> Cancel';
            } else {
                pollCreator.style.display = 'none';
                toggleBtn.innerHTML = '<i class="fas fa-plus"></i> Create';
            }
        }

        function addPollOption() {
            const pollOptions = document.querySelector('.poll-options');
            const optionCount = pollOptions.children.length + 1;
            
            const newOption = document.createElement('div');
            newOption.className = 'poll-option';
            newOption.innerHTML = `
                <input type="text" placeholder="Option ${String.fromCharCode(64 + optionCount)}">
                <i class="fas fa-times" onclick="removeOption(this)" style="cursor: pointer; color: var(--accent-red);"></i>
            `;
            
            pollOptions.appendChild(newOption);
        }

        function removeOption(element) {
            const pollOptions = document.querySelector('.poll-options');
            if (pollOptions.children.length > 2) {
                element.parentElement.remove();
            } else {
                showNotification('At least 2 options required', 'warning');
            }
        }

        function launchPoll() {
            const question = document.getElementById('pollQuestion').value.trim();
            const optionInputs = document.querySelectorAll('.poll-option input');
            const options = Array.from(optionInputs).map(input => input.value.trim()).filter(option => option);
            
            if (!question || options.length < 2) {
                showNotification('Please enter a question and at least 2 options', 'warning');
                return;
            }
            
            activePoll = {
                question: question,
                options: options,
                responses: options.map(() => 0),
                totalResponses: 0
            };
            
            displayActivePoll();
            togglePollCreator();
            
            showNotification('🚀 Poll launched successfully! Students can now vote.', 'success');
            
            setTimeout(() => simulatePollResponses(), 2000);
        }

        function displayActivePoll() {
            const activePollArea = document.getElementById('activePollArea');
            
            activePollArea.innerHTML = `
                <div class="active-poll">
                    <div class="poll-question">${activePoll.question}</div>
                    <div class="poll-responses">
                        ${activePoll.options.map((option, index) => `
                            <div class="response-bar">
                                <div class="response-option">${option}</div>
                                <div class="response-progress">
                                    <div class="response-fill" style="width: 0%" id="response-${index}"></div>
                                </div>
                                <div class="response-count" id="count-${index}">0</div>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <strong>Total Responses: <span id="totalResponses">0</span></strong>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-danger" onclick="endPoll()">
                                <i class="fas fa-stop"></i>
                                End Poll
                            </button>
                            <button class="btn btn-info" onclick="exportPollResults()" style="margin-left: 10px;">
                                <i class="fas fa-download"></i>
                                Export Results
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function simulatePollResponses() {
            if (!activePoll) return;
            
            const numResponses = Math.floor(Math.random() * 5) + 2;
            
            for (let i = 0; i < numResponses; i++) {
                setTimeout(() => {
                    const randomOption = Math.floor(Math.random() * activePoll.options.length);
                    activePoll.responses[randomOption]++;
                    activePoll.totalResponses++;
                    
                    updatePollDisplay();
                }, i * 800);
            }
        }

        function updatePollDisplay() {
            if (!activePoll) return;
            
            document.getElementById('totalResponses').textContent = activePoll.totalResponses;
            
            activePoll.responses.forEach((count, index) => {
                const percentage = activePoll.totalResponses > 0 ? 
                    (count / activePoll.totalResponses) * 100 : 0;
                
                const fillElement = document.getElementById(`response-${index}`);
                const countElement = document.getElementById(`count-${index}`);
                
                if (fillElement && countElement) {
                    fillElement.style.width = `${percentage}%`;
                    countElement.textContent = count;
                }
            });
        }

        function endPoll() {
            if (confirm('End the current poll? Results will be saved.')) {
                showNotification('📊 Poll ended. Results saved successfully!', 'success');
                
                document.getElementById('activePollArea').innerHTML = `
                    <div style="padding: 30px; text-align: center; color: var(--text-secondary);">
                        <i class="fas fa-poll" style="font-size: 2.5em; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>No active poll</p>
                        <small>Create a poll to engage with your students</small>
                    </div>
                `;
                
                activePoll = null;
            }
        }

        function exportPollResults() {
            if (!activePoll) return;
            
            const results = {
                question: activePoll.question,
                options: activePoll.options,
                responses: activePoll.responses,
                totalResponses: activePoll.totalResponses,
                timestamp: new Date().toISOString()
            };
            
            console.log('Poll Results:', results);
            showNotification('📊 Poll results exported successfully!', 'success');
        }

        function startScreenShare() {
            if (isScreenSharing) return;
            
            isScreenSharing = true;
            
            document.getElementById('screenShareArea').innerHTML = `
                <div style="text-align: center; color: var(--accent-green);">
                    <i class="fas fa-desktop" style="font-size: 4em; margin-bottom: 20px;"></i>
                    <p><strong>Screen sharing active</strong></p>
                    <small>Students can see your screen</small>
                </div>
            `;
            
            document.getElementById('screenControls').style.display = 'flex';
            document.getElementById('shareBtn').innerHTML = '<i class="fas fa-stop"></i> Stop Sharing';
            document.getElementById('shareBtn').onclick = stopScreenShare;
            
            showNotification('🖥️ Screen sharing started', 'success');
        }

        function stopScreenShare() {
            isScreenSharing = false;
            
            document.getElementById('screenShareArea').innerHTML = `
                <div style="text-align: center;">
                    <i class="fas fa-desktop" style="font-size: 4em; margin-bottom: 20px; opacity: 0.5;"></i>
                    <p>Screen sharing inactive</p>
                    <small>Click "Start Sharing" to share your screen with students</small>
                </div>
            `;
            
            document.getElementById('screenControls').style.display = 'none';
            document.getElementById('shareBtn').innerHTML = '<i class="fas fa-share-square"></i> Start Sharing';
            document.getElementById('shareBtn').onclick = startScreenShare;
            
            showNotification('🖥️ Screen sharing stopped', 'warning');
        }

        function pauseScreenShare() {
            showNotification('⏸️ Screen sharing paused', 'info');
        }

        function shareApplication() {
            showNotification('🖥️ Application sharing would open app selector in real implementation', 'info');
        }

        function togglePointer() {
            showNotification('👆 Pointer tool toggled', 'info');
        }

        function toggleRecording() {
            if (isRecording) {
                isRecording = false;
                document.getElementById('recordIcon').className = 'fas fa-video';
                showNotification('⏹️ Session recording stopped', 'warning');
            } else {
                isRecording = true;
                document.getElementById('recordIcon').className = 'fas fa-stop';
                showNotification('🔴 Session recording started', 'success');
            }
        }

        function toggleMute() {
            if (isMuted) {
                isMuted = false;
                document.getElementById('muteIcon').className = 'fas fa-microphone';
                showNotification('🔊 Audio unmuted', 'success');
            } else {
                isMuted = true;
                document.getElementById('muteIcon').className = 'fas fa-microphone-slash';
                showNotification('🔇 Audio muted', 'warning');
            }
        }

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
                document.getElementById('fullscreenIcon').className = 'fas fa-expand';
                showNotification('📺 Exited fullscreen mode', 'info');
            } else {
                document.documentElement.requestFullscreen();
                document.getElementById('fullscreenIcon').className = 'fas fa-compress';
                showNotification('📺 Entered fullscreen mode', 'info');
            }
        }

        function pauseSession() {
            showNotification('⏸️ Session paused. Students have been notified.', 'warning');
        }

        function endSession() {
            if (confirm('End the live session? All students will be disconnected.')) {
                showNotification('🛑 Ending session...', 'warning');
                setTimeout(() => {
                    window.location.href = 'dashboard.html';
                }, 2000);
            }
        }

        function startLiveUpdates() {
            // Simulate new chat messages
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const randomStudent = STUDENTS_DATA[Math.floor(Math.random() * STUDENTS_DATA.length)];
                    const questions = [
                        'Can you explain that concept again?',
                        'The screen is clear now, thank you!',
                        'Could you share the notes?',
                        'Is this topic in the exam?',
                        'Thank you for the explanation!',
                        'Can we have a quick break?',
                        'The audio is perfect now.',
                        'Could you slow down a bit?'
                    ];
                    
                    const randomQuestion = questions[Math.floor(Math.random() * questions.length)];
                    
                    const newMessage = {
                        id: `msg_${Date.now()}`,
                        sender: randomStudent.name,
                        avatar: randomStudent.avatar,
                        text: randomQuestion,
                        time: new Date().toLocaleTimeString('en-US', { 
                            hour: 'numeric', 
                            minute: '2-digit',
                            hour12: true 
                        })
                    };
                    
                    chatMessages.push(newMessage);
                    displayChatMessages();
                }
            }, 15000);
            
            // Simulate poll responses
            setInterval(() => {
                if (activePoll && Math.random() > 0.8) {
                    simulatePollResponses();
                }
            }, 10000);
            
            // Simulate student status changes
            setInterval(() => {
                if (Math.random() > 0.9) {
                    refreshStudents();
                }
            }, 20000);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type} show`;
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                info: 'fas fa-info-circle',
                warning: 'fas fa-exclamation-triangle'
            };

            notification.innerHTML = `
                <i class="${icons[type]}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 400);
            }, 4000);
        }

        // Handle window resize for canvas
        window.addEventListener('resize', () => {
            if (canvas) {
                const container = canvas.parentElement;
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                ctx.putImageData(imageData, 0, 0);
            }
        });

        // Close text input when clicking outside
        document.addEventListener('click', function(e) {
            if (isAddingText && !textInput.contains(e.target) && !canvas.contains(e.target)) {
                finishTextInput();
            }
        });

        // Handle click outside sidebar on mobile
        document.addEventListener('click', function(e) {
            const sidebar = document.getElementById('sidebar');
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            
            if (window.innerWidth <= 768 && 
                sidebar.classList.contains('active') && 
                !sidebar.contains(e.target) && 
                !mobileMenuBtn.contains(e.target)) {
                closeMobileSidebar();
            }
        });
    </script>
</body>
</html>
