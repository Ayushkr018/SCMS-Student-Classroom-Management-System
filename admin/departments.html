<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Management - College Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="departments.css">
</head>
<body>
    <!-- Mobile Header - Enhanced -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <div class="mobile-logo">
                üéì <span>SCMS Departments</span>
            </div>
            <div class="mobile-controls">
                <button class="mobile-theme-toggle" onclick="toggleTheme()" 
                        title="Toggle Dark/Light Mode" aria-label="Toggle theme">
                    <i class="fas fa-moon" id="mobileThemeIcon"></i>
                </button>
                <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" 
                        aria-label="Toggle navigation menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileSidebar()"></div>

    <div class="dashboard">
        <!-- Sidebar - Enhanced -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>üéì SCMS</h2>
                <p>Admin Portal</p>
            </div>
            
            <div class="user-info" id="userInfo">
                <div class="user-avatar">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">Loading...</div>
                    <div class="user-role">Administrator</div>
                </div>
            </div>
            
            <!-- Theme Toggle - Enhanced -->
            <div class="theme-toggle-sidebar" onclick="toggleTheme()" 
                 tabindex="0" role="button" aria-label="Toggle theme">
                <div class="theme-toggle-icon">
                    <i class="fas fa-moon" id="themeIcon"></i>
                    <span id="themeLabel">Dark Mode</span>
                </div>
                <div class="theme-switch" id="themeSwitch">
                    <div class="theme-switch-handle"></div>
                </div>
            </div>
            
            <!-- Navigation - Enhanced -->
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="dashboard.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="users.html">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>Class Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="students.html">
                            <i class="fas fa-user-graduate"></i>
                            <span>Students</span>
                        </a>
                    </li>
                    <li>
                        <a href="teachers.html">
                            <i class="fas fa-user-tie"></i>
                            <span>Faculty</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="departments.html">
                            <i class="fas fa-building"></i>
                            <span>Departments</span>
                        </a>
                    </li>
                    <li>
                        <a href="labs.html">
                            <i class="fas fa-flask"></i>
                            <span>Lab Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="feedback.html">
                            <i class="fas fa-comment-dots"></i>
                            <span>Feedback & Complaints</span>
                        </a>
                    </li>
                    <li>
                        <a href="reports.html">
                            <i class="fas fa-chart-bar"></i>
                            <span>Reports & Analytics</span>
                        </a>
                    </li>
                    <li>
                        <a href="settings.html">
                            <i class="fas fa-cog"></i>
                            <span>System Settings</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header - Enhanced Mobile Support -->
            <div class="header">
                <div>
                    <h1>üèõÔ∏è Department Management</h1>
                    <p>Manage academic departments and programs</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-success" onclick="openAddDepartmentModal()">
                        <i class="fas fa-plus"></i>
                        <span class="btn-text">Add Department</span>
                    </button>
                    <button class="btn btn-primary" onclick="openLabManagementModal()">
                        <i class="fas fa-flask"></i>
                        <span class="btn-text">Manage Labs</span>
                    </button>
                    <button class="btn btn-warning" onclick="importDepartments()">
                        <i class="fas fa-upload"></i>
                        <span class="btn-text">Import</span>
                    </button>
                    <button class="btn btn-secondary" onclick="exportDepartments()">
                        <i class="fas fa-download"></i>
                        <span class="btn-text">Export</span>
                    </button>
                </div>
            </div>

            <!-- Stats Grid - Mobile Optimized -->
            <div class="stats-grid">
                <div class="stat-card total" tabindex="0">
                    <div class="stat-icon">
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number" id="totalDepartments">12</div>
                        <div class="stat-label">Total Departments</div>
                        <div class="stat-change">+2 from last month</div>
                    </div>
                </div>
                
                <div class="stat-card active" tabindex="0">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number" id="activeDepartments">10</div>
                        <div class="stat-label">Active Departments</div>
                        <div class="stat-change success">83% active</div>
                    </div>
                </div>
                
                <div class="stat-card faculty" tabindex="0">
                    <div class="stat-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number" id="totalFaculty">145</div>
                        <div class="stat-label">Total Faculty</div>
                        <div class="stat-change">Across all depts</div>
                    </div>
                </div>
                
                <div class="stat-card students" tabindex="0">
                    <div class="stat-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number" id="totalStudents">2,450</div>
                        <div class="stat-label">Total Students</div>
                        <div class="stat-change success">Enrolled students</div>
                    </div>
                </div>
            </div>

            <!-- Lab Statistics Section - Added -->
            <div class="lab-stats-section">
                <div class="lab-stats-header">
                    <h3><i class="fas fa-flask"></i> Lab Overview</h3>
                    <button class="btn btn-secondary btn-sm" onclick="openLabManagementModal()">
                        <i class="fas fa-cogs"></i>
                        <span class="btn-text">Manage Labs</span>
                    </button>
                </div>
                <div class="lab-stats-grid">
                    <div class="lab-stat-item">
                        <div class="lab-stat-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="lab-stat-info">
                            <div class="lab-stat-number" id="totalLabs">45</div>
                            <div class="lab-stat-label">Total Labs</div>
                        </div>
                    </div>
                    <div class="lab-stat-item">
                        <div class="lab-stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="lab-stat-info">
                            <div class="lab-stat-number" id="activeLabs">38</div>
                            <div class="lab-stat-label">Active Labs</div>
                        </div>
                    </div>
                    <div class="lab-stat-item">
                        <div class="lab-stat-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="lab-stat-info">
                            <div class="lab-stat-number" id="maintenanceLabs">7</div>
                            <div class="lab-stat-label">Under Maintenance</div>
                        </div>
                    </div>
                    <div class="lab-stat-item">
                        <div class="lab-stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="lab-stat-info">
                            <div class="lab-stat-number" id="labUtilization">84%</div>
                            <div class="lab-stat-label">Utilization Rate</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters Section - Mobile Optimized -->
            <div class="filters-section">
                <div class="search-box">
                    <input type="text" class="search-input" 
                           placeholder="Search departments, labs, faculty..." 
                           id="searchInput" onkeyup="searchDepartments()"
                           aria-label="Search departments">
                    <i class="fas fa-search search-icon"></i>
                </div>
                
                <select class="filter-select" id="statusFilter" 
                        onchange="filterDepartments()" aria-label="Filter by status">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                    <option value="under-review">Under Review</option>
                </select>
                
                <select class="filter-select" id="typeFilter" 
                        onchange="filterDepartments()" aria-label="Filter by type">
                    <option value="">All Types</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Science">Science</option>
                    <option value="Arts">Arts</option>
                    <option value="Commerce">Commerce</option>
                    <option value="Medical">Medical</option>
                    <option value="Management">Management</option>
                </select>

                <select class="filter-select" id="labFilter" 
                        onchange="filterDepartments()" aria-label="Filter by lab availability">
                    <option value="">All Labs</option>
                    <option value="has-labs">With Labs</option>
                    <option value="no-labs">No Labs</option>
                    <option value="high-utilization">High Utilization (&gt;80%)</option>
                    <option value="low-utilization">Low Utilization (&lt;60%)</option>
                </select>
            </div>

            <!-- Bulk Actions - Mobile Optimized -->
            <div class="bulk-actions" id="bulkActions" style="display: none;">
                <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" 
                       aria-label="Select all departments">
                <span class="selected-count" id="selectedCount">0 departments selected</span>
                <button class="btn btn-warning btn-sm" onclick="bulkAction('activate')">
                    <i class="fas fa-check"></i>
                    <span class="btn-text">Activate</span>
                </button>
                <button class="btn btn-danger btn-sm" onclick="bulkAction('deactivate')">
                    <i class="fas fa-ban"></i>
                    <span class="btn-text">Deactivate</span>
                </button>
                <button class="btn btn-primary btn-sm" onclick="exportSelected()">
                    <i class="fas fa-download"></i>
                    <span class="btn-text">Export</span>
                </button>
            </div>

            <!-- Departments Section - Mobile Optimized -->
            <div class="departments-section">
                <div class="table-header">
                    <h3>
                        <i class="fas fa-building"></i> 
                        Department Directory
                        <span class="count-badge" id="departmentCount">12</span>
                    </h3>
                    <div class="view-controls">
                        <button class="btn btn-sm view-btn active" id="cardViewBtn" 
                                onclick="switchView('card')" title="Card View" aria-label="Switch to card view">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button class="btn btn-sm view-btn" id="tableViewBtn" 
                                onclick="switchView('table')" title="Table View" aria-label="Switch to table view">
                            <i class="fas fa-table"></i>
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="refreshDepartments()">
                            <i class="fas fa-sync-alt"></i>
                            <span class="btn-text">Refresh</span>
                        </button>
                    </div>
                </div>

                <!-- Card View Container -->
                <div class="departments-container" id="departmentsContainer">
                    <!-- Department cards will be dynamically populated here -->
                </div>

                <!-- Table View Container -->
                <div class="table-container" id="tableContainer" style="display: none;">
                    <table>
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="masterCheckbox" 
                                           onchange="toggleMasterCheckbox()" 
                                           aria-label="Select all visible departments">
                                </th>
                                <th>Department Info</th>
                                <th>Head of Department</th>
                                <th>Faculty Count</th>
                                <th>Student Count</th>
                                <th>Lab Facilities</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="departmentsTableBody">
                            <!-- Table rows will be dynamically populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <i class="fas fa-building"></i>
                    <h3>No Departments Found</h3>
                    <p>No departments match your current filters. Try adjusting your search criteria or add a new department.</p>
                    <button class="btn btn-primary" onclick="openAddDepartmentModal()">
                        <i class="fas fa-plus"></i>
                        Add First Department
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Department Modal - Enhanced -->
    <div class="modal" id="departmentModal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Department</h3>
                <button class="close-btn" onclick="closeModal('departmentModal')" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="departmentForm" onsubmit="saveDepartment(event)" novalidate>
                <div class="form-section">
                    <h4><i class="fas fa-building"></i> Department Information</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="departmentName">Department Name *</label>
                            <input type="text" id="departmentName" name="name" required 
                                   placeholder="e.g., Computer Science Engineering">
                        </div>
                        
                        <div class="form-group">
                            <label for="departmentCode">Department Code *</label>
                            <input type="text" id="departmentCode" name="code" required 
                                   placeholder="e.g., CSE" maxlength="10">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="departmentType">Department Type *</label>
                            <select id="departmentType" name="type" required>
                                <option value="">Select Type</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Science">Science</option>
                                <option value="Arts">Arts</option>
                                <option value="Commerce">Commerce</option>
                                <option value="Medical">Medical</option>
                                <option value="Management">Management</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="establishedYear">Established Year</label>
                            <input type="number" id="establishedYear" name="establishedYear" 
                                   min="1900" max="2030" placeholder="2020">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="departmentDescription">Description</label>
                        <textarea id="departmentDescription" name="description" rows="3" 
                                  placeholder="Department description and objectives"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <h4><i class="fas fa-user-tie"></i> Leadership & Contact</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="hodName">Head of Department</label>
                            <input type="text" id="hodName" name="hodName" 
                                   placeholder="Dr. John Smith">
                        </div>
                        
                        <div class="form-group">
                            <label for="hodEmail">HOD Email</label>
                            <input type="email" id="hodEmail" name="hodEmail" 
                                   placeholder="hod@department.edu">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="departmentPhone">Department Phone</label>
                            <input type="tel" id="departmentPhone" name="phone" 
                                   placeholder="+91-98765-43210">
                        </div>
                        
                        <div class="form-group">
                            <label for="departmentEmail">Department Email</label>
                            <input type="email" id="departmentEmail" name="email" 
                                   placeholder="info@department.edu">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="officeLocation">Office Location</label>
                        <input type="text" id="officeLocation" name="location" 
                               placeholder="Building A, Floor 2, Room 201">
                    </div>
                </div>

                <div class="form-section">
                    <h4><i class="fas fa-chart-bar"></i> Department Statistics</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="facultyCount">Faculty Count</label>
                            <input type="number" id="facultyCount" name="facultyCount" 
                                   min="0" placeholder="25">
                        </div>
                        
                        <div class="form-group">
                            <label for="studentCapacity">Student Capacity</label>
                            <input type="number" id="studentCapacity" name="capacity" 
                                   min="0" placeholder="500">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="currentStudents">Current Students</label>
                            <input type="number" id="currentStudents" name="currentStudents" 
                                   min="0" placeholder="450">
                        </div>
                        
                        <div class="form-group">
                            <label for="departmentStatus">Status</label>
                            <select id="departmentStatus" name="status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="under-review">Under Review</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save Department
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('departmentModal')">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Lab Management Modal - Enhanced -->
    <div class="modal" id="labManagementModal" role="dialog" aria-labelledby="labManagementTitle" aria-hidden="true">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="labManagementTitle"><i class="fas fa-flask"></i> Laboratory Management</h3>
                <button class="close-btn" onclick="closeModal('labManagementModal')" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="lab-management-content">
                <div class="lab-management-header">
                    <div class="lab-search">
                        <input type="text" placeholder="Search labs..." id="labSearchInput" 
                               onkeyup="searchLabs()" aria-label="Search laboratories">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="lab-filters">
                        <select id="labDepartmentFilter" onchange="filterLabsByDepartment()" 
                                aria-label="Filter labs by department">
                            <option value="">All Departments</option>
                        </select>
                        <select id="labTypeFilter" onchange="filterLabsByType()" 
                                aria-label="Filter labs by type">
                            <option value="">All Lab Types</option>
                            <option value="Computer Lab">Computer Lab</option>
                            <option value="Electronics Lab">Electronics Lab</option>
                            <option value="Workshop Lab">Workshop Lab</option>
                            <option value="Research Lab">Research Lab</option>
                            <option value="Chemistry Lab">Chemistry Lab</option>
                            <option value="Physics Lab">Physics Lab</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="openAddLabModal()">
                        <i class="fas fa-plus"></i>
                        Add Lab
                    </button>
                </div>
                <div class="labs-grid" id="labsGrid">
                    <!-- Lab cards will be populated here -->
                </div>
                <div class="empty-lab-state" id="emptyLabState" style="display: none;">
                    <i class="fas fa-flask"></i>
                    <h3>No Labs Found</h3>
                    <p>No laboratories match your current filters or no labs have been added yet.</p>
                    <button class="btn btn-success" onclick="openAddLabModal()">
                        <i class="fas fa-plus"></i>
                        Add First Lab
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Lab Modal - Enhanced -->
    <div class="modal" id="addLabModal" role="dialog" aria-labelledby="labModalTitle" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="labModalTitle">Add New Laboratory</h3>
                <button class="close-btn" onclick="closeModal('addLabModal')" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="labForm" onsubmit="saveLab(event)" novalidate>
                <div class="form-section">
                    <h4><i class="fas fa-flask"></i> Laboratory Information</h4>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="labName">Lab Name *</label>
                            <input type="text" id="labName" name="name" required 
                                   placeholder="Programming Lab">
                        </div>
                        
                        <div class="form-group">
                            <label for="labType">Lab Type *</label>
                            <select id="labType" name="type" required>
                                <option value="">Select Lab Type</option>
                                <option value="Computer Lab">Computer Lab</option>
                                <option value="Electronics Lab">Electronics Lab</option>
                                <option value="Workshop Lab">Workshop Lab</option>
                                <option value="Chemistry Lab">Chemistry Lab</option>
                                <option value="Physics Lab">Physics Lab</option>
                                <option value="Research Lab">Research Lab</option>
                                <option value="Language Lab">Language Lab</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="labDepartment">Department *</label>
                            <select id="labDepartment" name="department" required>
                                <option value="">Select Department</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="labCapacity">Capacity *</label>
                            <input type="number" id="labCapacity" name="capacity" required 
                                   min="1" placeholder="30">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="labIncharge">Lab In-charge</label>
                            <input type="text" id="labIncharge" name="incharge" 
                                   placeholder="Prof. Smith">
                        </div>
                        
                        <div class="form-group">
                            <label for="labLocation">Location</label>
                            <input type="text" id="labLocation" name="location" 
                                   placeholder="Block A, Ground Floor">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="labEquipment">Equipment (one per line)</label>
                        <textarea id="labEquipment" name="equipment" rows="4" 
                                  placeholder="Desktop PCs&#10;Projector&#10;Whiteboard&#10;Air Conditioning"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="labSoftware">Software (one per line)</label>
                        <textarea id="labSoftware" name="software" rows="3" 
                                  placeholder="Visual Studio&#10;MySQL&#10;Eclipse"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="utilizationRate">Utilization Rate (%)</label>
                            <input type="number" id="utilizationRate" name="utilization" 
                                   min="0" max="100" placeholder="85">
                        </div>
                        
                        <div class="form-group">
                            <label for="labStatus">Status</label>
                            <select id="labStatus" name="status">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="maintenance">Under Maintenance</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Save Laboratory
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addLabModal')">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Department Details Modal - Enhanced -->
    <div class="modal" id="departmentDetailsModal" role="dialog" aria-labelledby="departmentDetailsTitle" aria-hidden="true">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="departmentDetailsTitle">Department Details</h3>
                <button class="close-btn" onclick="closeModal('departmentDetailsModal')" aria-label="Close modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="department-details-view" id="departmentDetailsContent">
                <!-- Department details will be populated here -->
            </div>
        </div>
    </div>

    <!-- Notification - Enhanced -->
    <div class="notification" id="notification" role="alert" aria-live="polite">
        <i class="fas fa-check-circle" id="notificationIcon"></i>
        <span id="notificationText">Success message</span>
    </div>

    <!-- Loading Overlay (Optional) -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading departments...</p>
        </div>
    </div>

    <script src="departments.js"></script>
</body>
</html>
